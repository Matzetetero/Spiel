<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Space Vanguard</title>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 800px; height: 600px; border: 4px solid #222; box-shadow: 0 0 50px #003300; }
        canvas { display: block; background: #000; }
        .hud { position: absolute; top: 15px; left: 15px; pointer-events: none; text-shadow: 2px 2px #000; font-size: 18px; }
    </style>
</head>
<body>
    <div id="game-container">
        <div class="hud">SCORE: <span id="score">0</span> | HIGH: <span id="highscore">0</span><br>HP: <span id="player-hp">3</span></div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 600;

        // Spiel-Variablen
        let score = 0, highscore = localStorage.getItem('spaceHighscore') || 0, gameOver = false;
        document.getElementById('highscore').innerText = highscore;

        const player = { x: 400, y: 500, w: 40, h: 40, hp: 3, speed: 5, powerMode: false };
        const keys = {};
        const bullets = [], enemyBullets = [], enemies = [], stars = [], powerUps = [];

        // Sternenhintergrund Setup
        for(let i=0; i<100; i++) stars.push({x: Math.random()*800, y: Math.random()*600, s: Math.random()*2});

        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;
        canvas.onmousedown = () => { if(gameOver) location.reload(); };

        function drawShip(x, y, color, isPlayer=false) {
            ctx.fillStyle = color;
            ctx.beginPath();
            if(isPlayer) {
                ctx.moveTo(x + 20, y); ctx.lineTo(x, y + 40); ctx.lineTo(x + 10, y + 35); 
                ctx.lineTo(x + 30, y + 35); ctx.lineTo(x + 40, y + 40);
            } else {
                ctx.moveTo(x + 20, y + 40); ctx.lineTo(x, y); ctx.lineTo(x + 40, y);
            }
            ctx.closePath(); ctx.fill();
            // Leuchteffekt
            ctx.strokeStyle = "white"; ctx.lineWidth = 1; ctx.stroke();
        }

        function spawnFormation() {
            if(gameOver) return;
            const type = Math.random() > 0.5 ? 'V' : 'LINE';
            const startX = Math.random() * 400 + 100;
            for(let i=0; i<5; i++) {
                enemies.push({
                    x: type === 'V' ? startX + (i-2)*50 : startX + (i-2)*60,
                    y: type === 'V' ? -50 - Math.abs(i-2)*30 : -50,
                    hp: 2, shootTimer: Math.random()*100, phase: Math.random()*Math.PI*2
                });
            }
        }
        setInterval(spawnFormation, 3000);

        function update() {
            if(gameOver) return;
            ctx.fillStyle = "black"; ctx.fillRect(0,0,800,600);

            // 1. Sterne
            ctx.fillStyle = "white";
            stars.forEach(s => { s.y += s.s; if(s.y > 600) s.y = 0; ctx.fillRect(s.x, s.y, s.s, s.s); });

            // 2. Spieler-Bewegung (WASD)
            if(keys['KeyW'] && player.y > 0) player.y -= player.speed;
            if(keys['KeyS'] && player.y < 560) player.y += player.speed;
            if(keys['KeyA'] && player.x > 0) player.x -= player.speed;
            if(keys['KeyD'] && player.x < 760) player.x += player.speed;

            // Automatisches Schießen oder Leertaste
            if(Date.now() % 200 < 20) {
                bullets.push({x: player.x + 18, y: player.y, w: 4, h: 12});
                if(player.powerMode) {
                    bullets.push({x: player.x, y: player.y + 10, w: 4, h: 12});
                    bullets.push({x: player.x + 36, y: player.y + 10, w: 4, h: 12});
                }
            }

            drawShip(player.x, player.y, "#00d4ff", true);

            // 3. Gegner Logik (Formation & Schießen)
            enemies.forEach((e, ei) => {
                e.y += 1.5;
                e.x += Math.sin(e.y / 50 + e.phase) * 2; // Zick-Zack/Formation
                drawShip(e.x, e.y, "#ff4444");

                e.shootTimer--;
                if(e.shootTimer <= 0) {
                    enemyBullets.push({x: e.x + 18, y: e.y + 40});
                    e.shootTimer = 100 + Math.random()*100;
                }

                // Kollision Spieler-Gegner
                if(Math.abs(player.x - e.x) < 30 && Math.abs(player.y - e.y) < 30) endGame();
            });

            // 4. Projektile
            bullets.forEach((b, bi) => {
                b.y -= 8; ctx.fillStyle = "#0f0"; ctx.fillRect(b.x, b.y, b.w, b.h);
                enemies.forEach((e, ei) => {
                    if(b.x > e.x && b.x < e.x + 40 && b.y > e.y && b.y < e.y + 40) {
                        e.hp--; bullets.splice(bi, 1);
                        if(e.hp <= 0) {
                            if(Math.random() > 0.9) powerUps.push({x: e.x, y: e.y});
                            enemies.splice(ei, 1); score += 10;
                        }
                    }
                });
            });

            enemyBullets.forEach((eb, ebi) => {
                eb.y += 5; ctx.fillStyle = "orange"; ctx.beginPath(); ctx.arc(eb.x, eb.y, 4, 0, Math.PI*2); ctx.fill();
                if(eb.x > player.x && eb.x < player.x + 40 && eb.y > player.y && eb.y < player.y + 40) {
                    player.hp--; enemyBullets.splice(ebi, 1);
                    document.getElementById('player-hp').innerText = player.hp;
                    if(player.hp <= 0) endGame();
                }
            });

            // 5. Power-Ups
            powerUps.forEach((p, pi) => {
                p.y += 2; ctx.fillStyle = "cyan"; ctx.fillText("⚡", p.x, p.y);
                if(Math.abs(player.x - p.x) < 40 && Math.abs(player.y - p.y) < 40) {
                    player.powerMode = true; powerUps.splice(pi, 1);
                    setTimeout(() => player.powerMode = false, 5000);
                }
            });

            document.getElementById('score').innerText = score;
            requestAnimationFrame(update);
        }

        function endGame() {
            gameOver = true;
            if(score > highscore) localStorage.setItem('spaceHighscore', score);
            ctx.fillStyle = "rgba(0,0,0,0.8)"; ctx.fillRect(0,0,800,600);
            ctx.fillStyle = "red"; ctx.font = "40px Arial"; ctx.fillText("MISSION FAILED", 250, 300);
            ctx.fillStyle = "white"; ctx.font = "20px Arial"; ctx.fillText("Klick zum Neustart", 310, 340);
        }

        update();
    </script>
</body>
</html>
