<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Space Vanguard: Boss Edition</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Courier New', monospace; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        canvas { background: #000; border: 2px solid #333; box-shadow: 0 0 20px #003366; }
        .ui { position: absolute; top: 10px; left: 10px; pointer-events: none; text-shadow: 2px 2px #000; line-height: 1.5; }
        #boss-bar-container { position: absolute; top: 50px; width: 60%; height: 15px; border: 2px solid #fff; display: none; }
        #boss-bar { height: 100%; background: #f00; width: 100%; transition: width 0.2s; }
    </style>
</head>
<body>
    <div class="ui">
        SCORE: <span id="score">0</span> | HIGH: <span id="highscore">0</span><br>
        SHIELD: <span id="hp">3</span> | [F] VOLLBILD | [LEER] FEUER
    </div>
    <div id="boss-bar-container"><div id="boss-bar"></div></div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 600;

        let score = 0, highscore = localStorage.getItem('spaceBossHigh') || 0, gameOver = false, bossActive = false;
        const player = { x: 380, y: 500, w: 45, h: 45, hp: 3, speed: 5, powerType: null, powerTimer: 0 };
        const keys = {}, bullets = [], enemyBullets = [], enemies = [], stars = [], powerUps = [], boss = { active: false, hp: 0, maxHp: 50, x: 0, y: -100 };

        for(let i=0; i<150; i++) stars.push({x: Math.random()*800, y: Math.random()*600, s: Math.random()*2});

        window.onkeydown = (e) => { 
            keys[e.code] = true; 
            if(e.code === 'KeyF') toggleFullscreen();
            if(e.code === 'Space' && !gameOver) shoot();
        };
        window.onkeyup = (e) => keys[e.code] = false;

        function toggleFullscreen() {
            if (!document.fullscreenElement) canvas.requestFullscreen();
            else document.exitFullscreen();
        }

        function drawShip(x, y, color, type) {
            ctx.save(); ctx.translate(x + 22, y + 22);
            if(type === 'enemy') ctx.rotate(Math.PI);
            ctx.fillStyle = color; ctx.strokeStyle = "#fff"; ctx.lineWidth = 1;
            
            // Komplexeres Schiff-Design
            ctx.beginPath();
            ctx.moveTo(0, -22); ctx.lineTo(-10, -5); ctx.lineTo(-22, 10); ctx.lineTo(-8, 15);
            ctx.lineTo(8, 15); ctx.lineTo(22, 10); ctx.lineTo(10, -5);
            ctx.closePath(); ctx.fill(); ctx.stroke();
            
            // Cockpit & Triebwerk
            ctx.fillStyle = "rgba(0, 255, 255, 0.5)"; ctx.fillRect(-5, -10, 10, 8);
            if(type === 'player') { ctx.fillStyle = "#f90"; ctx.fillRect(-4, 15, 8, 5); }
            ctx.restore();
        }

        function shoot() {
            bullets.push({x: player.x + 20, y: player.y, w: 4, h: 15});
            if(player.powerType === 'S') {
                bullets.push({x: player.x, y: player.y + 10, w: 4, h: 15});
                bullets.push({x: player.x + 40, y: player.y + 10, w: 4, h: 15});
            }
        }

        function spawnBoss() {
            boss.active = true; boss.hp = boss.maxHp; boss.x = 300; boss.y = 50;
            document.getElementById('boss-bar-container').style.display = 'block';
        }

        function update() {
            if(gameOver) return;
            ctx.fillStyle = "#000"; ctx.fillRect(0,0,800,600);

            // Sterne & Bewegung
            ctx.fillStyle = "#fff";
            stars.forEach(s => { s.y += s.s; if(s.y > 600) s.y = 0; ctx.fillRect(s.x, s.y, s.s, s.s); });

            if(keys['KeyW'] && player.y > 0) player.y -= player.speed;
            if(keys['KeyS'] && player.y < 550) player.y += player.speed;
            if(keys['KeyA'] && player.x > 0) player.x -= player.speed;
            if(keys['KeyD'] && player.x < 750) player.x += player.speed;

            drawShip(player.x, player.y, "#00aaff", 'player');

            // Boss Logik
            if(boss.active) {
                boss.x += Math.sin(Date.now()/500) * 3;
                drawShip(boss.x, boss.y, "#ff0000", 'enemy');
                ctx.scale(2, 2); // Boss ist größer gezeichnet (vereinfacht)
                if(Date.now() % 800 < 20) enemyBullets.push({x: boss.x + 20, y: boss.y + 40});
                
                document.getElementById('boss-bar').style.width = (boss.hp / boss.maxHp * 100) + "%";
            } else if(score > 0 && score % 1000 === 0 && !boss.active) spawnBoss();

            // Gegner & Projektile (stark gekürzt für Übersicht)
            bullets.forEach((b, bi) => {
                b.y -= 10; ctx.fillStyle = "#0f0"; ctx.fillRect(b.x, b.y, b.w, b.h);
                if(boss.active && b.x > boss.x && b.x < boss.x + 60 && b.y < boss.y + 60) {
                    boss.hp--; bullets.splice(bi, 1);
                    if(boss.hp <= 0) { boss.active = false; score += 500; document.getElementById('boss-bar-container').style.display = 'none'; }
                }
            });

            // Power-Up System
            if(Math.random() > 0.998) powerUps.push({x: Math.random()*700, y: -20, t: ['S','H','B'][Math.floor(Math.random()*3)]});
            powerUps.forEach((p, pi) => {
                p.y += 2; ctx.fillStyle = "#ff0"; ctx.fillText("["+p.t+"]", p.x, p.y);
                if(Math.abs(player.x - p.x) < 40 && Math.abs(player.y - p.y) < 40) {
                    if(p.t === 'H') player.hp = Math.min(5, player.hp + 1);
                    else { player.powerType = p.t; player.powerTimer = 500; }
                    powerUps.splice(pi, 1);
                }
            });

            document.getElementById('score').innerText = score;
            document.getElementById('hp').innerText = player.hp;
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
